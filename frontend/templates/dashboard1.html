{% extends "base.html" %}

{% block title %}Dashboard View 1{% endblock %}

{% block content %}
<h1 class="h3 mb-4 text-gray-800">Dashboard View 1</h1>

<div class="container-fluid">
  <h1 class="h3 mb-4 text-gray-800">Welcome, Chris</h1>

  <!-- Summary cards row -->
  <div class="row mb-4">
    <!-- Total Students -->
    <div class="col-md-3 mb-4">
      <div class="card border-left-primary shadow h-100 py-2">
        <div class="card-body d-flex align-items-center justify-content-between">
          <div>
            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Total Students</div>
            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ total_students }}</div>
          </div>
          <div class="icon text-primary">
            <i class="fas fa-users fa-2x"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Exam Sets Created -->
    <div class="col-md-3 mb-4">
      <div class="card border-left-success shadow h-100 py-2">
        <div class="card-body d-flex align-items-center justify-content-between">
          <div>
            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Exam Sets Created</div>
            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ total_exam_sets }}</div>
          </div>
          <div class="icon text-success">
            <i class="fas fa-file-upload fa-2x"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <!-- English Top -->
    <div class="col-md-6 mb-4">
      <div class="card shadow h-100">
        <div class="card-body">
          <div class="d-flex align-items-center mb-3">
            <h5 class="card-title text-primary mb-0 flex-grow-1">Top 5 Performing English Students</h5>
            <select id="english-filter" class="form-control form-control-sm w-auto ml-3">
              <option value="all">All (Average VR + RC)</option>
              <option value="verbal">Verbal Reasoning</option>
              <option value="reading">Reading Comprehension</option>
            </select>
          </div>
          <ul id="top-english-list" class="list-group list-group-flush"></ul>
        </div>
      </div>
    </div>

    <!-- English Bottom -->
    <div class="col-md-6 mb-4">
      <div class="card shadow h-100">
        <div class="card-body">
          <div class="d-flex align-items-center mb-3">
            <h5 class="card-title text-danger mb-0 flex-grow-1">Struggling English Students</h5>
            <select id="english-filter-bottom" class="form-control form-control-sm w-auto ml-3">
              <option value="all">All (Average VR + RC)</option>
              <option value="verbal">Verbal Reasoning</option>
              <option value="reading">Reading Comprehension</option>
            </select>
          </div>
          <ul id="bottom-english-list" class="list-group list-group-flush"></ul>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <!-- Math Top -->
    <div class="col-md-6 mb-4">
      <div class="card shadow h-100">
        <div class="card-body">
          <div class="d-flex align-items-center mb-3">
            <h5 class="card-title text-primary mb-0 flex-grow-1">Top 5 Performing Maths Students</h5>
            <select id="math-filter" class="form-control form-control-sm w-auto ml-3">
              <option value="all">All (Average M + NR)</option>
              <option value="math">Mathematics</option>
              <option value="num">Numerical Reasoning</option>
            </select>
          </div>
          <ul id="top-math-list" class="list-group list-group-flush"></ul>
        </div>
      </div>
    </div>

    <!-- Math Bottom -->
    <div class="col-md-6 mb-4">
      <div class="card shadow h-100">
        <div class="card-body">
          <div class="d-flex align-items-center mb-3">
            <h5 class="card-title text-danger mb-0 flex-grow-1">Struggling Maths Students</h5>
            <select id="math-filter-bottom" class="form-control form-control-sm w-auto ml-3">
              <option value="all">All (Average M + NR)</option>
              <option value="math">Mathematics</option>
              <option value="num">Numerical Reasoning</option>
            </select>
          </div>
          <ul id="bottom-math-list" class="list-group list-group-flush"></ul>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Server data passed as JSON objects
  const topEnglish = {
    all: {{ top_english_all | tojson }},
    verbal: {{ top_english_verbal | tojson }},
    reading: {{ top_english_reading | tojson }}
  };
  const bottomEnglish = {
    all: {{ bottom_english_all | tojson }},
    verbal: {{ bottom_english_verbal | tojson }},
    reading: {{ bottom_english_reading | tojson }}
  };
  const topMath = {
    all: {{ top_math_all | tojson }},
    math: {{ top_math_math | tojson }},
    num: {{ top_math_num | tojson }}
  };
  const bottomMath = {
    all: {{ bottom_math_all | tojson }},
    math: {{ bottom_math_math | tojson }},
    num: {{ bottom_math_num | tojson }}
  };

  function renderList(containerId, list, selectedKey, badgeClass) {
    const ul = document.getElementById(containerId);
    ul.innerHTML = '';
    if (list.length === 0) {
      ul.innerHTML = '<li class="list-group-item text-muted">No data available.</li>';
      return;
    }
    list.forEach(item => {
      const li = document.createElement('li');
      li.className = 'list-group-item d-flex justify-content-between align-items-center';
      li.textContent = item[0];  // student name

      const span = document.createElement('span');
      span.className = `badge badge-pill ${badgeClass}`;

      if (selectedKey === 'all') {
        if (item.length === 3) {
          let label1, label2;
          if (containerId.includes('english')) {
            label1 = 'VR';
            label2 = 'RC';
          } else if (containerId.includes('math')) {
            label1 = 'M';
            label2 = 'NR';
          } else {
            label1 = 'Comp1';
            label2 = 'Comp2';
          }
          span.textContent = `${label1}: ${item[1].toFixed(1)}% / ${label2}: ${item[2].toFixed(1)}%`;
        } else {
          span.textContent = `${item[1].toFixed(1)}%`;
        }
      } else {
        let label = selectedKey.toUpperCase();
        if(selectedKey === 'num') label = 'NR';
        else if(selectedKey === 'verbal') label = 'VR';
        else if(selectedKey === 'reading') label = 'RC';
        else if(selectedKey === 'math') label = 'M';

        span.textContent = `${label}: ${item[1].toFixed(1)}%`;
      }

      li.appendChild(span);
      ul.appendChild(li);
    });
  }

  function setupDropdown(filterId, listId, dataObject, badgeClass) {
    const select = document.getElementById(filterId);
    const render = () => {
      const val = select.value;
      renderList(listId, dataObject[val], val, badgeClass);
    };
    select.addEventListener('change', render);
    render();
  }

  document.addEventListener('DOMContentLoaded', () => {
    setupDropdown('english-filter', 'top-english-list', topEnglish, 'badge-success');
    setupDropdown('english-filter-bottom', 'bottom-english-list', bottomEnglish, 'badge-danger');
    setupDropdown('math-filter', 'top-math-list', topMath, 'badge-success');
    setupDropdown('math-filter-bottom', 'bottom-math-list', bottomMath, 'badge-danger');
  });
</script>

{% endblock %}


